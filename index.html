<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Paper</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 5px;
        }
        img {
            max-width: 100%;
            /* margin: 10px; */
        }
        .loading {
            font-size: 18px;
            color: blue;
        }
        .heading {
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- <div style="text-align: right;margin-bottom: -30px;">24 Dec 2024, Tuesday</div> -->
    <div style="text-align: center;background: #252424;padding: 12px;margin: -5px -5px 10px -5px;">
        <marquee behavior="scroll" bgcolor="#252424" loop="-1">
            <i>
                <font color="#efefef">
                    <strong>Today's date is :<span id="time">25/12/2024, 07:18:15</span></strong>  
                </font>
            </i>
        </marquee>
        <img src="https://www.gujaratsamachar.com/assets/footer-logo.png">
    </div>
    <!-- <h1 class="heading">News Paper</h1> -->
    <!-- <p>Click the button to fetch images from the server and display them below.</p> -->
    <!-- <button id="fetchImages">Fetch Images</button> -->
    <!-- <button id="next">Next</button>
    <button id="prev">Prev</button> -->
    <div id="main" style="display:none;"></div>
    <div id="district" style="display:none;">
        <div style="display: flex;justify-content: space-around;"><h3>Anand-Kheda District</h3><h3>આણંદ ખેડા જિલ્લો        </h3></div>
    </div>
    <div id="magazines" style="display:none;">
        <div style="display: flex;justify-content: space-around;"><h3>Magazines</h3><h3 id="magzName" style="text-transform: capitalize;"></h3></div>
    </div>

    <script>
        var today = new Date();
        var day = today.getUTCDay();
        document.getElementById('time').innerHTML=today.toDateString();
        console.log('day:', day);
        var magazinesList = ['ravipurti', '', 'sahiyar', 'shatdal', 'dharmalok', 'chitralok', 'zagmag', '']; // 0 - 6 : Sunday - Saturday
        var currentPage = 1; // Track the current page
        const main = document.getElementById('main');
        const district = document.getElementById('district');
        const magazines = document.getElementById('magazines');

        // Format date in "YYYY-MM-DD"
        var formattedDate = today.toISOString().split('T')[0];
        console.log('Formatted date:', formattedDate);
        for (let index = 1; index < 20; index++) {
            const mainText = document.createElement('b');
            mainText.innerHTML = "Page "+index;
            mainText.id = "mainText-"+index;
            mainText.style = "text-align: center;margin-bottom: -25px;position: relative;";
            const mainImg = document.createElement('img');
            mainImg.id = "mainImg-"+index;
            mainImg.alt = 'Fetched Image';
            main.appendChild(mainText);
            main.appendChild(mainImg);

            const districtText = document.createElement('b');
            districtText.innerHTML = "Page "+index;
            districtText.id = "districtText-"+index;
            districtText.style = "text-align: center";
            const districtImg = document.createElement('img');
            districtImg.id = "districtImg-"+index;
            districtImg.alt = 'Fetched Image';

            district.appendChild(districtText);
            district.appendChild(districtImg);

            const magazinesText = document.createElement('b');
            magazinesText.innerHTML = "Page "+index;
            magazinesText.id = "magazinesText-"+index;
            magazinesText.style = "text-align: center";
            const magazinesImg = document.createElement('img');
            magazinesImg.id = "magazinesImg-"+index;
            magazinesImg.alt = 'Fetched Image';

            magazines.appendChild(magazinesText);
            magazines.appendChild(magazinesImg);
        }
        

        function updateDateTime() {
            var d = new Date()
            document.getElementById('time').innerHTML=d.toLocaleString();
        }
        setInterval(updateDateTime, 1000);

        onloadScript();
        async function onloadScript() {
            await loadPages('ahmedabad', 20, 'main');
            await loadPages('kheda-anand', 10, 'district');
            if (magazinesList[day]) {
                document.getElementById('magzName').innerHTML = magazinesList[day];
                await loadPages(magazinesList[day], 10, 'magazines');
            } 
        }
        // loadPages('kheda-anand', 10, 'magazines');


        async function fetchData(i, title, type) {
            // output.innerHTML = '<p class="loading">Fetching images...</p>';

            try {
                var im = document.getElementById(type+'Img-'+i);
                var t = document.getElementById(type+'Text-'+i);
                im.style = "display: none;"
                t.style = "display: none;"
                // Construct the URL with the query parameters
                // const url = `http://localhost:3000/fetch-images?title=${encodeURIComponent(title)}&date=${encodeURIComponent(formattedDate)}&number=${encodeURIComponent(i)}`;
                const url = `https://epaper-3q7v.onrender.com/fetch-images?title=${encodeURIComponent(title)}&date=${encodeURIComponent(formattedDate)}&number=${encodeURIComponent(i)}`;

                // Make a request to the backend
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch images. Status: ${response.status}`);
                }

                // Parse JSON response
                const images = await response.json();
                console.log('Server response:', images);

                // Clear output before appending new content
                // output.innerHTML = '';

                // Check if there are images in the response
                if (!Array.isArray(images) || images.length === 0) {
                    // output.innerHTML = '<p>No images found.</p>';
                    return;
                }

                // Dynamically create image elements and append them
                images.forEach((imgSrc) => {
                    // const img = document.createElement('img');
                    // img.src = imgSrc;
                    // img.alt = 'Fetched Image';
                    // output.appendChild(img);
                    
                    im.src = imgSrc;
                    im.style = "text-align: center;display: block;"
                    t.style = "text-align: center;margin-bottom: -25px;position: relative;display: block;"
                });
            } catch (error) {
                console.error('Error:', error);
                // output.innerHTML = '<p>Error fetching images. Check the console for details.</p>';
            }
        }

        function loadPages(title, pageCount, type) {
            // currentPage = 1; // Reset to page 1 when "Fetch Images" is clicked
            for (let index = 1; index < 20; index++) {
                setTimeout(async () => {
                    currentPage = index;
                    await fetchData(index, title, type);
                    console.log('currentPage:', currentPage, type);
                    if (index == 5) {
                        main.style = 'display:block;';
                        district.style = 'display:block;';
                        magazines.style = 'display:block;';
                    }
                }, 500*index);
            }
        }
    </script>
</body>
</html>
